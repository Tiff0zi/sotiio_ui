<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>sotiio container</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    html, body {
      height: 100%;
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #1e1e1e;
      overflow: hidden;
    }
    
    #drawer {
      height: 100vh;
      width: 100%;
      background: #262626;
      color: #f5f5f5;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    .dw-tabs {
      display: flex;
      background: #181818;
      border-bottom: 1px solid #333;
    }
    
    .dw-tab {
      flex: 1;
      padding: 12px 10px;
      text-align: center;
      cursor: pointer;
      border: 0;
      background: transparent;
      font-weight: 500;
      color: #aaa;
      border-bottom: 2px solid transparent;
      font-family: inherit;
    }
    
    .dw-tab.active {
      background: #262626;
      border-bottom: 2px solid #FF6A3C;
      color: #fff;
    }
    
    .dw-body {
      padding: 12px 16px;
      overflow: auto;
      height: 100%;
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    pre {
      margin: 0;
      padding: 12px;
      background: #1f1f1f;
      border: 1px solid #333;
      border-radius: 10px;
      white-space: pre-wrap;
      word-break: break-word;
      font: 12px/1.45 ui-monospace, Menlo, Consolas, monospace;
    }
    
    table.meta {
      width: 100%;
      border-collapse: collapse;
      background: #1f1f1f;
      border: 1px solid #333;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 12px;
    }
    
    table.meta th, table.meta td {
      padding: 10px 12px;
      border-bottom: 1px solid #333;
      font-size: 14px;
    }
    
    table.meta th {
      width: 30%;
      background: #202020;
      text-align: left;
      color: #ddd;
    }
    
    .wiki-item {
      background: #1f1f1f;
      border: 1px solid #333;
      border-radius: 10px;
      padding: 10px 12px;
      margin: 0 0 10px;
    }
    
    .wiki-item h3 {
      margin: 0 0 6px;
      font-size: 15px;
      color: #fff;
    }
    
    .wiki-item div {
      font-size: 14px;
      color: #ddd;
      line-height: 1.4;
    }
    
    .empty {
      color: #999;
      font-style: italic;
      padding: 16px 0;
    }
  </style>
</head>
<body>
  <aside id="drawer" aria-hidden="false">
    <div class="dw-tabs">
      <button class="dw-tab active" data-tab="meta">Meta</button>
      <button class="dw-tab" data-tab="wiki">Wiki</button>
      <button class="dw-tab" data-tab="links">Links</button>
      <button class="dw-tab" data-tab="raw">Raw Data</button>
    </div>
    <div class="dw-body">
      <div id="tab-meta" class="tab-content active">
        <div class="empty">Выберите узел на карте для просмотра деталей</div>
      </div>
      <div id="tab-wiki" class="tab-content">
        <div class="empty">Выберите узел на карте для просмотра деталей</div>
      </div>
      <div id="tab-links" class="tab-content">
        <div class="empty">Выберите узел на карте для просмотра деталей</div>
      </div>
      <div id="tab-raw" class="tab-content">
        <pre id="raw-pre">Выберите узел на карте для просмотра деталей</pre>
      </div>
    </div>
  </aside>

  <script>
  (function(){
    const tabButtons = document.querySelectorAll('.dw-tab');
    const tabContents = {
      meta:  document.getElementById('tab-meta'),
      wiki:  document.getElementById('tab-wiki'),
      links: document.getElementById('tab-links'),
      raw:   document.getElementById('tab-raw')
    };
    const rawPre = document.getElementById('raw-pre');
    
    function activateTab(name){
      tabButtons.forEach(btn => {
        btn.classList.toggle('active', btn.dataset.tab === name);
      });
      Object.keys(tabContents).forEach(key => {
        tabContents[key].classList.toggle('active', key === name);
      });
    }
    
    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => activateTab(btn.dataset.tab));
    });
    
    function clearContent(){
      tabContents.meta.innerHTML  = '<div class="empty">Выберите узел на карте для просмотра деталей</div>';
      tabContents.wiki.innerHTML  = '<div class="empty">Выберите узел на карте для просмотра деталей</div>';
      tabContents.links.innerHTML = '<div class="empty">Выберите узел на карте для просмотра деталей</div>';
      rawPre.textContent          = 'Выберите узел на карте для просмотра деталей';
    }
    
    clearContent();
    
    function renderMeta(metaObj){
      if(!metaObj || typeof metaObj !== 'object'){
        tabContents.meta.innerHTML = '<div class="empty">Нет meta-данных для узла</div>';
        return;
      }
      
      const entries = Object.entries(metaObj);
      if(!entries.length){
        tabContents.meta.innerHTML = '<div class="empty">Meta-поля пусты</div>';
        return;
      }
      
      const rows = entries.map(([k,v])=>{
        let val = (typeof v === 'object') ? JSON.stringify(v, null, 2) : String(v);
        return `<tr><th>${k}</th><td>${val}</td></tr>`;
      }).join('');
      
      tabContents.meta.innerHTML = `
        <table class="meta">
          <tbody>${rows}</tbody>
        </table>
      `;
    }
    
    function renderWiki(wikiArr){
      if(!Array.isArray(wikiArr) || !wikiArr.length){
        tabContents.wiki.innerHTML = '<div class="empty">Wiki-полей нет</div>';
        return;
      }
      
      tabContents.wiki.innerHTML = wikiArr.map(item=>{
        const title = item.title || item.name || 'Без названия';
        const text  = item.text || item.description || '';
        return `
          <div class="wiki-item">
            <h3>${title}</h3>
            <div>${text}</div>
          </div>
        `;
      }).join('');
    }
    
    function renderLinks(linksArr){
      if(!Array.isArray(linksArr) || !linksArr.length){
        tabContents.links.innerHTML = '<div class="empty">Ссылок нет</div>';
        return;
      }
      
      tabContents.links.innerHTML = linksArr.map(link=>{
        const url = link.url || link.href || '#';
        const label = link.label || link.title || url;
        return `<div><a href="${url}" target="_blank" rel="noopener noreferrer">${label}</a></div>`;
      }).join('');
    }
    
    function renderRaw(payload){
      rawPre.textContent = JSON.stringify(payload, null, 2);
    }
    
    function setData(payload){
      clearContent();
      if(!payload || typeof payload !== 'object'){
        renderRaw(payload);
        return;
      }
      
      const meta = payload.meta || payload.meta_data || null;
      const wiki = payload.wiki || [];
      const links = payload.links || [];
      
      renderMeta(meta);
      renderWiki(wiki);
      renderLinks(links);
      renderRaw(payload);
    }

    // Связь с index.html
    window.addEventListener('message', (ev)=>{ 
      const msg = ev.data || {}; 
      if(msg.type === 'container:set') setData(msg.payload); 
    });

    // Ручной API
    window.ContainerAPI = { setData };
  })();
  </script>
</body>
</html>
